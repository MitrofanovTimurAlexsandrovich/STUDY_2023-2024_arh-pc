---
## Front matter
title: "Лабораторная работа №9."
subtitle: "Понятие подпрограммы. Отладчик GDB."
author: "Митрофанов Тимур Александрович"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: PT Serif
romanfont: PT Serif
sansfont: PT Sans
monofont: PT Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Приобретение навыков написания программ с использованием подпрограмм. Знакомство с методами отладки при помощи GDB и его основными возможностями.

# Выполнение лабораторной работы

Создал подкаталог *lab09*. В нём создал файл touch *lab09-1.asm* (рис. @fig:001). В созданный файл ввёл текст листинга 9.1(рис. @fig:002). Скомпелировал файл и проверил его работу (рис. @fig:003).

![Создание подкаталога и файла](image/001.png){#fig:001}

![Содержимое файла *lab09-1.asm*](image/002.png){#fig:002}

![Создание исполняемого файла *lab09-1* и его запуск](image/003.png){#fig:003}

В соответствии с заданием создал подпрограмму которая отвечает за вычисления (рис. @fig:004). Скомпелировал файл и проверил его работу (рис. @fig:005).

![Изменённое содержимое файла *lab09-1.asm*](image/004.png){#fig:004}

![Создание исполняемого файла и его запуск](image/005.png){#fig:005}

Создал файл *lab09-2.asm* (рис. @fig:006). В созданный файл ввёл текст листинга 9.2 (рис. @fig:007). Для работы с GDB при создании исполняемого файла добавил ключ ***-g*** (рис. @fig:008).

![Создание файла *lab09-2.asm*](image/006.png){#fig:006}

![Содержимое файла *lab09-2.asm*](image/007.png){#fig:007}

![Создание исполняемого файла *lab09-2*](image/008.png){#fig:008}

Загрузил исполняемый файл в отладчик gdb и запустил его в нём (рис. @fig:009).

![Загрузка исполняемого файла в отладчик gdb и его запуск](image/009.png){#fig:009}

Установил брейкпоинт на метку _start и запустил программу (рис. @fig:010).

![Установка брейкпоинта и запуск программы](image/010.png){#fig:010}

Посмотрел дисассимилированный код программы с помощью команды ***disassemble***, начиная с метки ***_start*** (рис. @fig:011).

![Ввод команды ***disassemble _start***](image/011.png){#fig:011}

Переключил на отображение команд с Intel’овским синтаксисом, введя команду ***set disassembly-flavor intel*** (рис. @fig:012).

![ереключение на отображение команд с Intel’овским синтаксисом](image/012.png){#fig:012}

***Перечил различия отображения синтаксиса машинных команд в режимах ATT и Intel.***

- В ATT имена регистров начинаются с символа %, а имена опрерандов с $, в то время как в intel используется привычный нам синтаксис.

Включил режим псевдографики для более удобного анализа программы (рис. @fig:013).

![Режим псевдографики](image/013.png){#fig:013}

Получил данные о брейкпоинтах (рис. @fig:014). Добавил ещё один брейкпоинт и проверил его наличие (рис. @fig:015).

![Режим псевдографики](image/014.png){#fig:014}

![Работа с брейкпоинтами](image/015.png){#fig:015}

Выполнил 5 инструкций с помощью команды stepi (рис. @fig:016).

![Выполнение инструкций](image/016.png){#fig:016}

Посмотрел содержимое регистров при помощи команды info registers (рис. @fig:017).

![Посмотр содержимого регистров](image/017.png){#fig:017}

Посмотрел значение переменной msg1 по имени (рис. @fig:018).

![Посмотр значения переменной msg1 по имени](image/018.png){#fig:018}

Посмотрел значение переменной msg2 по адресу (рис. @fig:019).

![Посмотр значения переменной msg2 по адресу](image/019.png){#fig:019}

Измененил первыый символ переменной msg1 на ***h*** (рис. @fig:020).

![Изменение значения переменной msg1](image/020.png){#fig:020}

Измененил первыый символ переменной msg2 на ***Q*** (рис. @fig:021).

![Изменение значения переменной msg2](image/021.png){#fig:021}

Выведел в различных форматах значение регистра edx (рис. @fig:022).

![различные форматы значений регистра edx](image/022.png){#fig:022}

С помощью команды ***set*** измените значение регистра *ebx* (рис. @fig:023).

![Изменение значения регистра *ebx* при помощи set](image/023.png){#fig:023}

***Объясните разницу вывода команд p/s $ebx.***

-  В первом случае мы переводим символ в строковой вид.

Завершил выполнение программы с помощью команды continue и выйшел из GDB с помощью команды quit (рис. @fig:024).

![Завершение работы с GDB](image/024.png){#fig:024}

Скопировал файл *lab8-2.asm* в файл с именем *lab09-3.asm* и создал исполняемый файл (рис. @fig:025).

![Создание файла *lab09-3.asm* и преобразование его в исполняемый файл](image/025.png){#fig:025}

Загрузил исполняемый файл в отладчик, указав аргументы (рис. @fig:026).

![Загрузка файла *lab09-3.asm* в отладчик](image/026.png){#fig:026}

установил точку остановки перед первой инструкцией в программе и запустил ее (рис. @fig:027).

![Установка брейкпойнта и запуск программы](image/027.png){#fig:027}

Проверил сколько в стеке хранится переменных (рис. @fig:028).

![Проверка стека](image/028.png){#fig:028}

Посмотрел остальные позиции стека (рис. @fig:029).

![Проверка переменных в стеке](image/029.png){#fig:029}

***Объясните, почему шаг изменения адреса равен 4 ([esp+4], [esp+8], [esp+12] и т.д.)***

- Так как занчение колличества аргументов равно 4

# Задание для самостоятельной работы

Создал файл *lab09-4.asm* (рис. @fig:030). Перенёс программу из лабораторной работы № 8 в файл и изменил в соответствии с заданием (рис. @fig:031). Создал исполнительный файл и проверил его работу (рис. @fig:032).

![Созлание файла *lab09-4.asm*](image/030.png){#fig:030}

![Содержимое файла *lab09-4.asm*](image/031.png){#fig:031}

![Создание файла *lab09-4* и проверка его работы](image/032.png){#fig:032}

***КОД ПРОГРАММЫЙ***

```
%include 'in_out.asm'
 
SECTION .data
msg db "Результат: ",0
 
SECTION .text

global _start
_start:
pop ecx 
pop edx 
sub ecx,1  
mov esi,0
 
next:
cmp ecx,0h 
jz _end 
 
pop eax 
call atoi
call proga
loop next
 
_end: 
mov eax, msg 
call sprint
mov eax, esi 
call iprintLF 
call quit

proga:
mov ebx,10
mul ebx
sub eax,5
add esi,eax
ret
```

Создал файл *lab09-5.asm* (рис. @fig:033). Внёс уод из листинга 9.3 в файл (рис. @fig:034). Создал исполнительный файл с применением отладчика, загрузил в него этот файл, подготовил программу для работы в отладчике (поставил брейкпойт, подключил граф. интр.) (рис. @fig:035).

![Созлание файла *lab09-5.asm*](image/033.png){#fig:033}

![Содержимое файла *lab09-5.asm*](image/034.png){#fig:034}

![Создание файла *lab09-5* и его первоначальная отладка в GDB](image/035.png){#fig:035}

Пошагово выполня программу нашел ошибку в использовании неправильного регистра при умножении (рис. @fig:036).

![Пошаговое выполнение программы](image/036.png){#fig:036}

Внёс необходимые изменения в файл *lab09-5.asm* (рис. @fig:037). Создал исполнительный файл и проверил его работу (рис. @fig:038).

![Содержимое файла *lab09-5.asm*](image/037.png){#fig:037}

![Создание файла *lab09-5* и проверка его работы](image/038.png){#fig:038}

***КОД ПРОГРАММЫЙ***
```
%include 'in_out.asm'
SECTION .data
div: DB 'Результат: ',0
SECTION .text
GLOBAL _start
_start:
; ---- Вычисление выражения (3+2)*4+5
mov ebx,3
mov eax,2
add eax,ebx
mov ecx,4
mul ecx
add eax,5
mov edi,eax
; ---- Вывод результата на экран
mov eax,div
call sprint
mov eax,edi
call iprintLF
call quit
```
# Выводы

Сегодня я приобрёл навыки написания программ с использованием подпрограмм. Познакомился с методами отладки при помощи GDB и его основными возможностями.

